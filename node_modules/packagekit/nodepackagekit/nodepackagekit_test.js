/*!
GPII Node.js PackageKit Bridge

Copyright 2013 Inclusive Design Research Centre, OCAD University

Licensed under the New BSD license. You may not use this file except in
compliance with this License.

You may obtain a copy of the License at
https://github.com/gpii/universal/LICENSE.txt
*/

var assert = require('assert');
var packagekit = require('./build/Release/nodepackagekit.node');

var testSearchPackage = function() {
    var pkg = packagekit.searchPackage ('tuxguitar');
    assert.notEqual (pkg.length, 0, "No package for tuxguitar was found during search");
    var name = pkg[0].id.indexOf ("tuxguitar");
    assert.notEqual (name, -1, "tuxguitar package not found, found " + pkg[0].id + " instead");
};

// Assume that machine is clean -- no tuxguitar package installed (see TODO
// below).
var testNotInstalledAtStart = function() {
    var pkg = packagekit.searchPackage ('tuxguitar');
    assert.notEqual (pkg.length, 0, "No package for tuxguitar was found");

    // TODO:  This tests that the package is not installed, but it's not really
    // an error if it's there.
    var notInstalled = pkg[0].data.indexOf ('installed');
    assert.equal (notInstalled, -1, "Package tuxguitar is installed, data property is: '" + pkg[0].data + "'");
};

var testInstallPackage = function() {
    var pkg = packagekit.searchPackage ('tuxguitar');
    assert.notEqual (pkg.length, 0, "No package for tuxguitar; cannot install");

    packagekit.installPackage (pkg[0].id);
    pkg = packagekit.searchPackage ('tuxguitar');
    var installed = pkg[0].data.indexOf ('installed');
    assert.notEqual (installed, -1, "Package tuxguitar failed to install, data property is: '" + pkg[0].data + "'");
};

var testRemovePackage = function() {
    var pkg = packagekit.searchPackage ('tuxguitar');
    assert.notEqual (pkg.length, 0, "No package for tuxguitar; cannot remove");

    packagekit.removePackage (pkg[0].id);
    pkg = packagekit.searchPackage ('tuxguitar');
    var removed = pkg[0].data.indexOf ('installed');
    assert.equal (removed, -1, "Failed to remove tuxguitar package, data property is: '" + pkg[0].data + "'");
};

testSearchPackage();
testNotInstalledAtStart();  // needed?
testInstallPackage();
testRemovePackage();
